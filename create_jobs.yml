---
- hosts: localhost
  vars:
    GIT_PERSONAL_ACCESS_TOKEN: !vault | 
          $ANSIBLE_VAULT;1.1;AES256
          37623834653562306332313739373166616631386233393237616564343534316437643063636238
          6366393232353562313063653231636633393030326662320a313837636663373365646463626636
          36653035343038363664643638626666653331613362336433363830323733663033376663643837
          3361663836386235310a313833303631616430633131353831643663383563653635396235336630
          32636133333234306663636465343535356461313662666335326630323035383330343831343964
          6361383531653833656466613235383664636130363938313032
  tasks:
     - github_hooks:
          action: create
          hookurl: http://34.210.70.136:8090/github-webhook/
          user: khantilchoksi
          oauthkey: "{{GIT_PERSONAL_ACCESS_TOKEN}}"
          repo: https://api.github.com/repos/khantilchoksi/checkbox.io 

- hosts: jenkins
  roles:
    - create_jobs
  tasks:
    - name: "Create EC2 instance for Checkbox.io Deployment"
      shell: 'ansible-playbook -i "localhost," -c local ~/provision_ec2.yml --extra-vars="param=deploy_checkboxio" -vvv  && sleep 30s && sudo chmod 400 /var/lib/jenkins/keys/deploy_checkboxio.pem'
      become: true
      become_user: jenkins
    #when: ec2 instance for checkbox.io not exists
    # - name: GET AWS Credentials
    #   shell: cat /var/lib/jenkins/.aws/credentials
    #   become: true
    #   register: aws_credentials
    
    # - name: SETTING up variable
    #   shell: "echo {{item.split("=")}}"
    #   with_items: cat /var/lib/jenkins/.aws/credentials
                                                                   
