---
- name: enabling access to mvn without password 
  lineinfile:
    path: /etc/sudoers
    line: "jenkins ALL=(ALL) NOPASSWD: ALL"
  become: true

#- name: copy jenkins_jobs.ini file to jenkins server
#  template:
#    src: ~/roles/create_jobs/templates/jenkins_jobs.ini
#    dest: /home/vagrant/jenkins_jobs.ini
#  become: true

#- name: create jobs folder if it doesn't exit
#  file:
#    path: "/home/ubuntu/jobs"
#    state: directory

- name: Copy private SSH Key for GitHub to var lib jenkins
  copy:
    src: ~/.ssh/git_rsa
    dest: /var/lib/jenkins/.ssh/id_rsa
    owner: jenkins
    group: jenkins
    mode: 0400
  become: true

- name: Copy iTrust jenkins job builder script
  template:
    src: "{{ project_directory }}/roles/create_jobs/templates/itrust_jenkins_jobs.yml"
    dest: ~/jobs/itrust_jenkins_jobs.yml
  # become: true

- name: Copy checkbox job builder script
  template:
    src: "{{ project_directory }}/roles/create_jobs/templates/checkbox_jenkins_jobs.yml"
    dest: ~/jobs/checkbox_jenkins_jobs.yml
  # become: true

- name: Copy iTrust Fuzzer jenkins job builder script
  template:
    src: "{{ project_directory }}/roles/create_jobs/templates/itrust_fuzzing.yml"
    dest: ~/jobs/itrust_fuzzing.yml
  
- name: create jobs
  shell: 'cd  && jenkins-jobs --conf ~/jenkins_jobs.ini update ~/jobs'
  #become: true

# New
- name: Creating new directory for test_reports
  file:
    path: /home/ubuntu/test_reports
    state: directory
    mode: 0666
