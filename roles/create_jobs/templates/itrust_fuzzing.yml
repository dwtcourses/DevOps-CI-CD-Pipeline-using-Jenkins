- job:
    name: "{{itrust_fuzzer_job_name}}"
    scm: 
      - git: 
          url: git@github.ncsu.edu:khchoksi/iTrust2-v2.git
          branches: 
            - origin/fuzzer
            - ${sha1}
    triggers:
      - pollscm:
          cron: "" 
    builders:
      - ansible-playbook:
            playbook: "~/builder_itrust_fuzzer.yml"
            inventory-type: "path"
            inventory:
              path: "~/local_inventory"
            additional-parameters: "--vault-password-file ~/.vault_pass.txt"
      # - shell: 'sudo cp /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/src/main/resources/hibernate.properties.template /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/src/main/resources/hibernate.properties'
      # - shell: 'sudo cp /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/src/main/java/db.properties.template /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/src/main/java/db.properties'
      # - shell: 'sudo cp /home/ubuntu/email.properties /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/src/main/java/email.properties'
      # - shell: 'sudo cp /home/ubuntu/pom-data.xml /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/pom-data.xml'
      # - shell: 'cd /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/ && sudo mvn -f pom-data.xml process-test-classes'
      # - shell: 'cd /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/ && sudo mvn clean test verify checkstyle:checkstyle'
      #- shell: 'today=`date +%Y-%m-%d.%H:%M:%S` && sudo cp -R /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/target/surefire-reports /home/ubuntu/test_reports/$today/'

    publishers:
    #   - jacoco:
    #       exec-pattern: '**/**.exec'
    #       #class-pattern: '**/EmailUtil.class'
    #       class-pattern: '**/classes'
    #       source-pattern: '**/src'
    #       update-build-status: true
    #       exclusion-pattern: '**/*Test*.class'
     - postbuildscript:
         builders:
            - build-steps:
              - shell: 'today=`date +%Y-%m-%d.%H:%M:%S` && sudo cp -R /var/lib/jenkins/workspace/{{itrust_fuzzer_job_name}}/iTrust2/target/surefire-reports /home/ubuntu/test_reports/$today/'



      # - ansible-playbook:
      #     playbook: "/home/ubuntu/itrust_fuzzer_builder.yml"
      #     inventory-type: "path"
      #     inventory:
      #       path: "/home/ubuntu/local_inventory" 
      #     additional-parameters: "-vvv"

#java -jar jenkins-cli.jar -s http://localhost:8080/ build itrust_job --username {{ jenkins_username }} --password {{ jenkins_password }}


