- job:
    name: "{{itrust_job_name}}"
    description: 'automatically generated test'
    project-type: freestyle
    builders:
      - shell: 'sudo git clone git@github.ncsu.edu:engr-csc326-staff/iTrust2-v2.git'
      - shell: 'sudo cp /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/resources/hibernate.properties.template /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/resources/hibernate.properties'
      - shell: 'sudo cp /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/java/db.properties.template /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/java/db.properties'
      - shell: 'sudo cp /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/java/email.properties.template /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/src/main/java/email.properties'
      - shell: 'cd /var/lib/jenkins/workspace/{{itrust_job_name}}/iTrust2-v2/iTrust2/ && sudo mvn process-test-classes && sudo mvn clean test verify checkstyle:checkstyle'
    publishers:
      - postbuildscript:
          builders:
             - shell: 'cd && sudo ansible-playbook -i "localhost," -c local /home/ubuntu/provision_ec2.yml --extra-vars="param=iTrust2" && sudo ansible-playbook -i /home/ubuntu/inventory /home/ubuntu/deploy_app_iTrust2.yml -s --vault-password-file /home/ubuntu/.vault_pass.txt '





#java -jar jenkins-cli.jar -s http://localhost:8080/ build itrust_job --username {{ jenkins_username }} --password {{ jenkins_password }}


